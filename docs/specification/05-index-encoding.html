<!DOCTYPE html>
<!-- BBF GitHub Pages pandoc template; modified from default.html template -->
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8"/>
  <meta name="generator" content="pandoc"/>
  <meta name="description" content="TR-369a2 – User Services Platform (USP): A standardized protocol to manage, monitor, update, and control connected devices, IoT endpoints, user services and home networks"/>
  <meta name="theme-color" content="#157878"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes"/>
  <title>BBF – 5 Message Encoding</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <link rel="stylesheet" href="github.css"/>
  <link rel="stylesheet" href="extra.css"/>
  <link rel="stylesheet" href="toc.css"/>
  <link rel="stylesheet" href="release.css"/>
  <link rel="stylesheet" href="local.css"/>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
  <!-- XXX header includes are included just before the ToC (below) -->
</head>

<body>
  <section class="page-header">
    <h1 class="project-name">
      <a href="../index.html" style="text-decoration: none; color: white;">
        <img src="bbflogo-bw.png"/><br>
        The User Services Platform
      </a>
    </h1>
    <h2 class="project-tagline">A standardized protocol to manage, monitor, update, and control connected devices, IoT endpoints, user services and home networks</h2>
    <p></p>
    <p></p>
    <div class="project-buttons">
      <a class="btn" href="../specification/index.html" title="USP Specification">Specification</a>
      <a class="btn" href="../specification/index.htm" title="USP Specification Single-file HTML">HTML</a>
      <a class="btn" href="../specification/index.pdf" title="USP Specification PDF">PDF</a>
      <a class="btn" href="https://usp-data-models.broadband-forum.org" title="USP Data Models">Data Models</a>
      <a class="btn" href="https://usp-test.broadband-forum.org" title="USP Test Plan">Test Plan</a>
      <a class="btn" href="../resources/01-index-usp-development-resources.html" title="USP Development Resources">Resources</a>
      <a class="btn" href="../faq/01-index-faq.html" title="USP Frequently Asked Questions">FAQ</a>
    </div>
  </section>

  <section class="main-content">
<nav>
<p>
   <a href="00-index-contents.html#contents">Cover Page</a>
 | <a href="01-index-introduction.html#sec:introduction">1 Introduction</a>
 | <a href="02-index-architecture.html#sec:architecture">2 Architecture</a>
 | <a href="03-index-discovery.html#sec:discovery">3 Discovery and Advertisement</a>
 | <a href="04-index-mtp.html#sec:mtp">4 Message Transfer Protocols</a>
 | <a href="05-index-encoding.html#sec:encoding">5 Message Encoding</a>
 | <a href="06-index-e2e-message-exchange.html#sec:e2e-message-exchange">6 End to End Message Exchange</a>
 | <a href="07-index-messages.html#sec:messages">7 Messages</a>
 | <a href="08-index-auth.html#sec:auth">8 Authentication and Authorization</a>
 | <a href="09-index-bulk-data-collection.html#sec:bulk-data-collection">Annex A: Bulk Data Collection</a>
 | <a href="10-index-software-module-management.html#sec:software-module-management">Appendix I: Software Module Management</a>
 | <a href="11-index-firmware-management-of-devices-with-usp-agents.html#sec:firmware-management-of-devices-with-usp-agents">Appendix II: Firmware Management of Devices with USP Agents</a>
 | <a href="12-index-device-proxy.html#sec:device-proxy">Appendix III: Device Proxy</a>
 | <a href="13-index-proxying.html#sec:proxying">Appendix IV: Proxying</a>
 | <a href="14-index-iot-data-model-theory-of-operation.html#sec:iot-data-model-theory-of-operation">Appendix V: IoT Data Model Theory of Operation</a>
 | <a href="99-index-footnotes.html#footnotes">Footnotes</a>
</p>
</nav>

<nav id="TOCFULL">
<ul>
  <li><a href="00-index-contents.html#contents">Cover Page</a></li>
  <li><a href="01-index-introduction.html#sec:introduction">1 Introduction</a></li>
  <ul>
    <li><a href="01-index-introduction.html#sec:executive-summary">1.1 Executive Summary</a></li>
    <li><a href="01-index-introduction.html#sec:purpose-and-scope">1.2 Purpose and Scope</a></li>
    <li><a href="01-index-introduction.html#sec:references-and-terminology">1.3 References and Terminology</a></li>
    <li><a href="01-index-introduction.html#sec:definitions">1.4 Definitions</a></li>
    <li><a href="01-index-introduction.html#sec:abbreviations">1.5 Abbreviations</a></li>
    <li><a href="01-index-introduction.html#sec:specification-impact">1.6 Specification Impact</a></li>
  </ul>
  <li><a href="02-index-architecture.html#sec:architecture">2 Architecture</a></li>
  <ul>
    <li><a href="02-index-architecture.html#sec:endpoints">2.1 Endpoints</a></li>
    <li><a href="02-index-architecture.html#sec:endpoint-identifier">2.2 Endpoint Identifier</a></li>
    <li><a href="02-index-architecture.html#sec:service-elements">2.3 Service Elements</a></li>
    <li><a href="02-index-architecture.html#sec:data-models">2.4 Data Models</a></li>
    <li><a href="02-index-architecture.html#sec:path-names">2.5 Path Names</a></li>
    <li><a href="02-index-architecture.html#sec:other-path-decorators">2.6 Other Path Decorators</a></li>
    <li><a href="02-index-architecture.html#sec:data-model-path-grammar">2.7 Data Model Path Grammar</a></li>
  </ul>
  <li><a href="03-index-discovery.html#sec:discovery">3 Discovery and Advertisement</a></li>
  <ul>
    <li><a href="03-index-discovery.html#sec:controller-information">3.1 Controller Information</a></li>
    <li><a href="03-index-discovery.html#sec:required-agent-information">3.2 Required Agent Information</a></li>
    <li><a href="03-index-discovery.html#sec:using-dhcp">3.3 Use of DHCP for Acquiring Controller Information</a></li>
    <li><a href="03-index-discovery.html#sec:using-mdns">3.4 Using mDNS</a></li>
    <li><a href="03-index-discovery.html#sec:using-dns">3.5 Using DNS</a></li>
    <li><a href="03-index-discovery.html#sec:dns-sd-records">3.6 DNS-SD Records</a></li>
    <li><a href="03-index-discovery.html#sec:using-the-sendonboardrequest-operation-and-onboardrequest-notification">3.7 Using the SendOnBoardRequest() operation and OnBoardRequest notification</a></li>
  </ul>
  <li><a href="04-index-mtp.html#sec:mtp">4 Message Transfer Protocols</a></li>
  <ul>
    <li><a href="04-index-mtp.html#sec:generic-requirements">4.1 Generic Requirements</a></li>
    <li><a href="04-index-mtp.html#sec:coap-binding-deprecated">4.2 CoAP Binding (DEPRECATED)</a></li>
    <li><a href="04-index-mtp.html#sec:websocket">4.3 WebSocket Binding</a></li>
    <li><a href="04-index-mtp.html#sec:stomp-binding">4.4 STOMP Binding</a></li>
    <li><a href="04-index-mtp.html#sec:mqtt-binding">4.5 MQTT Binding</a></li>
  </ul>
  <li><a href="05-index-encoding.html#sec:encoding">5 Message Encoding</a></li>
  <ul>
    <li><a href="05-index-encoding.html#sec:parameter-value-encoding">5.1 Parameter and Argument Value Encoding</a></li>
  </ul>
  <li><a href="06-index-e2e-message-exchange.html#sec:e2e-message-exchange">6 End to End Message Exchange</a></li>
  <ul>
    <li><a href="06-index-e2e-message-exchange.html#sec:exchange-of-usp-records-within-an-e2e-session-context">6.1 Exchange of USP Records within an E2E Session Context</a></li>
    <li><a href="06-index-e2e-message-exchange.html#sec:exchange-of-usp-records-without-an-e2e-session-context">6.2 Exchange of USP Records without an E2E Session Context</a></li>
    <li><a href="06-index-e2e-message-exchange.html#sec:validating-the-integrity-of-the-usp-record">6.3 Validating the Integrity of the USP Record</a></li>
    <li><a href="06-index-e2e-message-exchange.html#sec:secure-message-exchange">6.4 Secure Message Exchange</a></li>
  </ul>
  <li><a href="07-index-messages.html#sec:messages">7 Messages</a></li>
  <ul>
    <li><a href="07-index-messages.html#sec:encapsulation-in-a-usp-record">7.1 Encapsulation in a USP Record</a></li>
    <li><a href="07-index-messages.html#sec:requests-responses-and-errors">7.2 Requests, Responses and Errors</a></li>
    <li><a href="07-index-messages.html#sec:message-structure">7.3 Message Structure</a></li>
    <li><a href="07-index-messages.html#sec:creating-updating-and-deleting-objects">7.4 Creating, Updating, and Deleting Objects</a></li>
    <li><a href="07-index-messages.html#sec:reading-an-agents-state-and-capabilities">7.5 Reading an Agent’s State and Capabilities</a></li>
    <li><a href="07-index-messages.html#sec:notifications-and-subscriptions">7.6 Notifications and Subscription Mechanism</a></li>
    <li><a href="07-index-messages.html#sec:defined-operations-mechanism">7.7 Defined Operations Mechanism</a></li>
    <li><a href="07-index-messages.html#sec:error-codes">7.8 Error Codes</a></li>
  </ul>
  <li><a href="08-index-auth.html#sec:auth">8 Authentication and Authorization</a></li>
  <ul>
    <li><a href="08-index-auth.html#sec:authentication-1">8.1 Authentication</a></li>
    <li><a href="08-index-auth.html#sec:role-based-access-control-rbac">8.2 Role Based Access Control (RBAC)</a></li>
    <li><a href="08-index-auth.html#sec:trusted-certificate-authorities">8.3 Trusted Certificate Authorities</a></li>
    <li><a href="08-index-auth.html#sec:trusted-brokers">8.4 Trusted Brokers</a></li>
    <li><a href="08-index-auth.html#sec:self-signed-certificates">8.5 Self-Signed Certificates</a></li>
    <li><a href="08-index-auth.html#sec:agent-authentication">8.6 Agent Authentication</a></li>
    <li><a href="08-index-auth.html#sec:challenge-strings-and-images">8.7 Challenge Strings and Images</a></li>
    <li><a href="08-index-auth.html#sec:analysis-controller-certificates">8.8 Analysis of Controller Certificates</a></li>
    <li><a href="08-index-auth.html#sec:theory-of-operations">8.9 Theory of Operations</a></li>
  </ul>
  <li><a href="09-index-bulk-data-collection.html#sec:bulk-data-collection">Annex A: Bulk Data Collection</a></li>
  <ul>
    <li><a href="09-index-bulk-data-collection.html#sec:introduction-1">A.1 Introduction</a></li>
    <li><a href="09-index-bulk-data-collection.html#sec:http-bulk-data-collection">A.2 HTTP Bulk Data Collection</a></li>
    <li><a href="09-index-bulk-data-collection.html#sec:mqtt-bulk-data-collection">A.3 MQTT Bulk Data Collection</a></li>
    <li><a href="09-index-bulk-data-collection.html#sec:uspeventnotif-bulk-data-collection">A.4 USPEventNotif Bulk Data Collection</a></li>
    <li><a href="09-index-bulk-data-collection.html#sec:using-wildcards-to-reference-object-instances-in-the-report">A.5 Using Wildcards to Reference Object Instances in the Report</a></li>
    <li><a href="09-index-bulk-data-collection.html#sec:using-alternative-names-in-the-report">A.6 Using Alternative Names in the Report</a></li>
    <li><a href="09-index-bulk-data-collection.html#sec:encoding-of-bulk-data">A.7 Encoding of Bulk Data</a></li>
  </ul>
  <li><a href="10-index-software-module-management.html#sec:software-module-management">Appendix I: Software Module Management</a></li>
  <ul>
    <li><a href="10-index-software-module-management.html#sec:lifecycle-management">I.1 Lifecycle Management</a></li>
    <li><a href="10-index-software-module-management.html#sec:software-modules">I.2 Software Modules</a></li>
    <li><a href="10-index-software-module-management.html#sec:execution-environment-concepts">I.3 Execution Environment Concepts</a></li>
    <li><a href="10-index-software-module-management.html#sec:fault-model">I.4 Fault Model</a></li>
  </ul>
  <li><a href="11-index-firmware-management-of-devices-with-usp-agents.html#sec:firmware-management-of-devices-with-usp-agents">Appendix II: Firmware Management of Devices with USP Agents</a></li>
  <ul>
    <li><a href="11-index-firmware-management-of-devices-with-usp-agents.html#sec:getting-the-firmware-image-onto-the-device">II.1 Getting the firmware image onto the device</a></li>
    <li><a href="11-index-firmware-management-of-devices-with-usp-agents.html#sec:using-multiple-firmware-images">II.2 Using multiple firmware images</a></li>
  </ul>
  <li><a href="12-index-device-proxy.html#sec:device-proxy">Appendix III: Device Proxy</a></li>
  <li><a href="13-index-proxying.html#sec:proxying">Appendix IV: Proxying</a></li>
  <ul>
    <li><a href="13-index-proxying.html#sec:proxying-building-block-functions">IV.1 Proxying Building Block Functions</a></li>
    <li><a href="13-index-proxying.html#sec:discovery-proxy">IV.2 Discovery Proxy</a></li>
    <li><a href="13-index-proxying.html#sec:connectivity-proxy">IV.3 Connectivity Proxy</a></li>
    <li><a href="13-index-proxying.html#sec:message-transfer-protocol-mtp-proxy">IV.4 Message Transfer Protocol (MTP) Proxy</a></li>
    <li><a href="13-index-proxying.html#sec:usp-to-non-usp-proxy">IV.5 USP to Non-USP Proxy</a></li>
  </ul>
  <li><a href="14-index-iot-data-model-theory-of-operation.html#sec:iot-data-model-theory-of-operation">Appendix V: IoT Data Model Theory of Operation</a></li>
  <ul>
    <li><a href="14-index-iot-data-model-theory-of-operation.html#sec:introduction-2">V.1 Introduction</a></li>
    <li><a href="14-index-iot-data-model-theory-of-operation.html#sec:iot-data-model-overview">V.2 IoT data model overview</a></li>
    <li><a href="14-index-iot-data-model-theory-of-operation.html#sec:architecture-mappings">V.3 Architecture mappings</a></li>
    <li><a href="14-index-iot-data-model-theory-of-operation.html#sec:iot-data-model-object-details">V.4 IoT data model Object details</a></li>
    <li><a href="14-index-iot-data-model-theory-of-operation.html#sec:examples">V.5 Examples</a></li>
  </ul>
  <li><a href="99-index-footnotes.html#footnotes">Footnotes</a></li>
</ul>
</nav>

    <header id="title-block-header">
      <h1 class="title" id="sec:encoding">5 Message Encoding<a href="#sec:encoding" class="headerlink" title="Permalink to this header"> <img src="permalink.png" style="width: 0.8em"/></a></h1>
    </header>
    <nav id="_TOC" role="doc-toc">
<ul>
<li><a href="#sec:parameter-value-encoding">5.1 Parameter and Argument Value Encoding <span><img src="permalink.png" style="width:0.8em" /></span></a></li>
</ul>
    </nav>
<p>USP requires a mechanism to serialize data to be sent over a Message Transfer Protocol. The description of each individual Message and the USP Record encoding scheme is covered in a section of this document and/or in the referenced specification. This version of the specification includes support for:</p>
<ul>
<li>Protocol Buffers Version 3 <span class="cite" data-citation-ids="PROTOBUF"><a href="01-index-introduction.html#ref-PROTOBUF">[6]</a></span></li>
</ul>
<p><strong><span id="r-enc.0">R-ENC.0 <a href="05-index-encoding.html#r-enc.0" class="headerlink" title="Permalink to this span"><img src="permalink.png" style="width:0.8em" /></a></span></strong> - An implementation using protocol buffers encoding to encode USP Messages (Requests, Responses, and Errors) MUST conform to the schema defined in <a href="../specification/usp-msg-1-2.proto">usp-msg-1-2.proto</a>.</p>
<p><strong><span id="r-enc.1">R-ENC.1 <a href="05-index-encoding.html#r-enc.1" class="headerlink" title="Permalink to this span"><img src="permalink.png" style="width:0.8em" /></a></span></strong> - An implementation using protocol buffers encoding to encode USP Records MUST conform to the schema defined in <a href="../specification/usp-record-1-2.proto">usp-record-1-2.proto</a>.</p>
<p>Protocol Buffers Version 3 uses a set of enumerated elements to coordinate encoding and decoding during transmission. It is intended that these remain backwards compatible, but new versions of the schema may contain new enumerated elements.</p>
<p><strong><span id="r-enc.2">R-ENC.2 <a href="05-index-encoding.html#r-enc.2" class="headerlink" title="Permalink to this span"><img src="permalink.png" style="width:0.8em" /></a></span></strong> - If an Endpoint receives a USP payload containing an unknown enumeration value for a known field, the Endpoint MUST report the failure to the receiving MTP to indicate a “bad request” and do no further processing of the USP Record or USP Message.</p>
<p>Protocol Buffers uses a datatype called <code>oneof</code>. This means that the element contains elements of one or more varying types.</p>
<p><strong><span id="r-enc.3">R-ENC.3 <a href="05-index-encoding.html#r-enc.3" class="headerlink" title="Permalink to this span"><img src="permalink.png" style="width:0.8em" /></a></span></strong> - USP Records and USP Messages that contain an element of type <code>oneof</code> MUST include 1 and only 1 instance of the element, which MUST contain one of the possible elements.</p>
<p><strong><span id="r-enc.4">R-ENC.4 <a href="05-index-encoding.html#r-enc.4" class="headerlink" title="Permalink to this span"><img src="permalink.png" style="width:0.8em" /></a></span></strong> - A USP Record that violates <a href="05-index-encoding.html#r-enc.3" class="requirement">R-ENC.3</a> MUST be discarded.</p>
<p><strong><span id="r-enc.5">R-ENC.5 <a href="05-index-encoding.html#r-enc.5" class="headerlink" title="Permalink to this span"><img src="permalink.png" style="width:0.8em" /></a></span></strong> - A USP Message that violates <a href="05-index-encoding.html#r-enc.3" class="requirement">R-ENC.3</a> SHOULD return an error of type 7004 (Invalid Arguments).</p>
<h2 id="sec:parameter-value-encoding">5.1 Parameter and Argument Value Encoding <a href="05-index-encoding.html#sec:parameter-value-encoding" class="headerlink" title="Permalink to this header"><img src="permalink.png" style="width:0.8em" /></a></h2>
<p><a href="../specification/usp-msg-1-2.proto">usp-msg-1-2.proto</a> specifies that Parameter and argument values in USP Messages are represented as Protocol Buffers Version 3 strings (which are UTF-8-encoded).</p>
<p>This section specifies how Parameter and argument values are converted to and from Protocol Buffers Version 3 strings.</p>
<p><strong><span id="r-enc.6">R-ENC.6 <a href="05-index-encoding.html#r-enc.6" class="headerlink" title="Permalink to this span"><img src="permalink.png" style="width:0.8em" /></a></span></strong> - Parameter and argument values MUST be converted to and from Protocol Buffers Version 3 strings using the string representations of the TR-106 Appendix I.4 <span class="cite" data-citation-ids="TR-106"><a href="01-index-introduction.html#ref-TR-106">[37]</a></span> data types.</p>
<p>TR-106 Appendix I.4 states that “Parameters make use of a limited subset of the default SOAP data types”. The SOAP 1.1 specification <span class="cite" data-citation-ids="SOAP-1-1"><a href="01-index-introduction.html#ref-SOAP-1-1">[34]</a></span> states that all SOAP simple types are defined by the XML Schema Part 2: Datatypes specification <span class="cite" data-citation-ids="XMLSCHEMA-2"><a href="01-index-introduction.html#ref-XMLSCHEMA-2">[39]</a></span>, and this is the ultimate reference.</p>
<p>In practice there should be few surprises, e.g., XML Schema Part 2, Section 3.3.22 <span class="cite" data-citation-ids="XMLSCHEMA-2"><a href="01-index-introduction.html#ref-XMLSCHEMA-2">[39]</a></span> states that it has a lexical representation consisting of a finite-length sequence of decimal digits (#x30-#x39).</p>
<p>Some of the encoding rules are quite complicated, e.g. SOAP 1.1, Section 5.2.3 <span class="cite" data-citation-ids="SOAP-1-1"><a href="01-index-introduction.html#ref-SOAP-1-1">[34]</a></span> states that <code>base64</code> line length restrictions don’t apply to SOAP, and XML Schema Part 2, Section 3.2.7 <span class="cite" data-citation-ids="XMLSCHEMA-2"><a href="01-index-introduction.html#ref-XMLSCHEMA-2">[39]</a></span> has a lot of detail about which aspects of ISO 8601 are and are not supported by the <code>dateTime</code> data type.</p>
    <div style="clear: both;"/>
    <footer class="site-footer">
<nav>
<p>
   <a href="00-index-contents.html#contents">Cover Page</a>
 | <a href="01-index-introduction.html#sec:introduction">1 Introduction</a>
 | <a href="02-index-architecture.html#sec:architecture">2 Architecture</a>
 | <a href="03-index-discovery.html#sec:discovery">3 Discovery and Advertisement</a>
 | <a href="04-index-mtp.html#sec:mtp">4 Message Transfer Protocols</a>
 | <a href="05-index-encoding.html#sec:encoding">5 Message Encoding</a>
 | <a href="06-index-e2e-message-exchange.html#sec:e2e-message-exchange">6 End to End Message Exchange</a>
 | <a href="07-index-messages.html#sec:messages">7 Messages</a>
 | <a href="08-index-auth.html#sec:auth">8 Authentication and Authorization</a>
 | <a href="09-index-bulk-data-collection.html#sec:bulk-data-collection">Annex A: Bulk Data Collection</a>
 | <a href="10-index-software-module-management.html#sec:software-module-management">Appendix I: Software Module Management</a>
 | <a href="11-index-firmware-management-of-devices-with-usp-agents.html#sec:firmware-management-of-devices-with-usp-agents">Appendix II: Firmware Management of Devices with USP Agents</a>
 | <a href="12-index-device-proxy.html#sec:device-proxy">Appendix III: Device Proxy</a>
 | <a href="13-index-proxying.html#sec:proxying">Appendix IV: Proxying</a>
 | <a href="14-index-iot-data-model-theory-of-operation.html#sec:iot-data-model-theory-of-operation">Appendix V: IoT Data Model Theory of Operation</a>
 | <a href="99-index-footnotes.html#footnotes">Footnotes</a>
</p>
</nav>

      <span class="site-footer-owner">
        USP is developed and maintained
        by <a href="https://www.broadband-forum.org">The Broadband Forum</a>.
        &copy; The Broadband Forum 2022</a>. All Rights Reserved.
      </span>
      <span class="site-footer-credits">
        This page was generated by <a href="https://pandoc.org">pandoc</a>
        and <a href="https://pages.github.com">GitHub Pages</a>.
        View the <a href="https://github.com/BroadbandForum/usp">specification source on GitHub</a>.
        <span class="release"/>
      </span>
    </footer>
  </section>
</body>
</html>
