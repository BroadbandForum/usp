<!DOCTYPE html>
<!-- BBF GitHub Pages pandoc template; modified from default.html template -->
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8"/>
  <meta name="generator" content="pandoc"/>
  <meta name="description" content="TR-369a2 – User Services Platform (USP): A standardized protocol to manage, monitor, update, and control connected devices, IoT endpoints, user services and home networks"/>
  <meta name="theme-color" content="#157878"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes"/>
  <title>BBF – 3 Discovery and Advertisement</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <link rel="stylesheet" href="github.css"/>
  <link rel="stylesheet" href="extra.css"/>
  <link rel="stylesheet" href="toc.css"/>
  <link rel="stylesheet" href="release.css"/>
  <link rel="stylesheet" href="local.css"/>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
  <!-- XXX header includes are included just before the ToC (below) -->
</head>

<body>
  <section class="page-header">
    <h1 class="project-name">
      <a href="../index.html" style="text-decoration: none; color: white;">
        <img src="bbflogo-bw.png"/><br>
        The User Services Platform
      </a>
    </h1>
    <h2 class="project-tagline">A standardized protocol to manage, monitor, update, and control connected devices, IoT endpoints, user services and home networks</h2>
    <p></p>
    <p></p>
    <div class="project-buttons">
      <a class="btn" href="../specification/index.html" title="USP Specification">Specification</a>
      <a class="btn" href="../specification/index.htm" title="USP Specification Single-file HTML">HTML</a>
      <a class="btn" href="../specification/index.pdf" title="USP Specification PDF">PDF</a>
      <a class="btn" href="https://usp-data-models.broadband-forum.org" title="USP Data Models">Data Models</a>
      <a class="btn" href="https://usp-test.broadband-forum.org" title="USP Test Plan">Test Plan</a>
      <a class="btn" href="../resources/01-index-usp-development-resources.html" title="USP Development Resources">Resources</a>
      <a class="btn" href="../faq/01-index-faq.html" title="USP Frequently Asked Questions">FAQ</a>
    </div>
  </section>

  <section class="main-content">
<nav>
<p>
   <a href="00-index-contents.html#contents">Cover Page</a>
 | <a href="01-index-introduction.html#sec:introduction">1 Introduction</a>
 | <a href="02-index-architecture.html#sec:architecture">2 Architecture</a>
 | <a href="03-index-discovery.html#sec:discovery">3 Discovery and Advertisement</a>
 | <a href="04-index-mtp.html#sec:mtp">4 Message Transfer Protocols</a>
 | <a href="05-index-encoding.html#sec:encoding">5 Message Encoding</a>
 | <a href="06-index-e2e-message-exchange.html#sec:e2e-message-exchange">6 End to End Message Exchange</a>
 | <a href="07-index-messages.html#sec:messages">7 Messages</a>
 | <a href="08-index-auth.html#sec:auth">8 Authentication and Authorization</a>
 | <a href="09-index-bulk-data-collection.html#sec:bulk-data-collection">Annex A: Bulk Data Collection</a>
 | <a href="10-index-software-module-management.html#sec:software-module-management">Appendix I: Software Module Management</a>
 | <a href="11-index-firmware-management-of-devices-with-usp-agents.html#sec:firmware-management-of-devices-with-usp-agents">Appendix II: Firmware Management of Devices with USP Agents</a>
 | <a href="12-index-device-proxy.html#sec:device-proxy">Appendix III: Device Proxy</a>
 | <a href="13-index-proxying.html#sec:proxying">Appendix IV: Proxying</a>
 | <a href="14-index-iot-data-model-theory-of-operation.html#sec:iot-data-model-theory-of-operation">Appendix V: IoT Data Model Theory of Operation</a>
 | <a href="99-index-footnotes.html#footnotes">Footnotes</a>
</p>
</nav>

<nav id="TOCFULL">
<ul>
  <li><a href="00-index-contents.html#contents">Cover Page</a></li>
  <li><a href="01-index-introduction.html#sec:introduction">1 Introduction</a></li>
  <ul>
    <li><a href="01-index-introduction.html#sec:executive-summary">1.1 Executive Summary</a></li>
    <li><a href="01-index-introduction.html#sec:purpose-and-scope">1.2 Purpose and Scope</a></li>
    <li><a href="01-index-introduction.html#sec:references-and-terminology">1.3 References and Terminology</a></li>
    <li><a href="01-index-introduction.html#sec:definitions">1.4 Definitions</a></li>
    <li><a href="01-index-introduction.html#sec:abbreviations">1.5 Abbreviations</a></li>
    <li><a href="01-index-introduction.html#sec:specification-impact">1.6 Specification Impact</a></li>
  </ul>
  <li><a href="02-index-architecture.html#sec:architecture">2 Architecture</a></li>
  <ul>
    <li><a href="02-index-architecture.html#sec:endpoints">2.1 Endpoints</a></li>
    <li><a href="02-index-architecture.html#sec:endpoint-identifier">2.2 Endpoint Identifier</a></li>
    <li><a href="02-index-architecture.html#sec:service-elements">2.3 Service Elements</a></li>
    <li><a href="02-index-architecture.html#sec:data-models">2.4 Data Models</a></li>
    <li><a href="02-index-architecture.html#sec:path-names">2.5 Path Names</a></li>
    <li><a href="02-index-architecture.html#sec:other-path-decorators">2.6 Other Path Decorators</a></li>
    <li><a href="02-index-architecture.html#sec:data-model-path-grammar">2.7 Data Model Path Grammar</a></li>
  </ul>
  <li><a href="03-index-discovery.html#sec:discovery">3 Discovery and Advertisement</a></li>
  <ul>
    <li><a href="03-index-discovery.html#sec:controller-information">3.1 Controller Information</a></li>
    <li><a href="03-index-discovery.html#sec:required-agent-information">3.2 Required Agent Information</a></li>
    <li><a href="03-index-discovery.html#sec:using-dhcp">3.3 Use of DHCP for Acquiring Controller Information</a></li>
    <li><a href="03-index-discovery.html#sec:using-mdns">3.4 Using mDNS</a></li>
    <li><a href="03-index-discovery.html#sec:using-dns">3.5 Using DNS</a></li>
    <li><a href="03-index-discovery.html#sec:dns-sd-records">3.6 DNS-SD Records</a></li>
    <li><a href="03-index-discovery.html#sec:using-the-sendonboardrequest-operation-and-onboardrequest-notification">3.7 Using the SendOnBoardRequest() operation and OnBoardRequest notification</a></li>
  </ul>
  <li><a href="04-index-mtp.html#sec:mtp">4 Message Transfer Protocols</a></li>
  <ul>
    <li><a href="04-index-mtp.html#sec:generic-requirements">4.1 Generic Requirements</a></li>
    <li><a href="04-index-mtp.html#sec:coap-binding-deprecated">4.2 CoAP Binding (DEPRECATED)</a></li>
    <li><a href="04-index-mtp.html#sec:websocket">4.3 WebSocket Binding</a></li>
    <li><a href="04-index-mtp.html#sec:stomp-binding">4.4 STOMP Binding</a></li>
    <li><a href="04-index-mtp.html#sec:mqtt-binding">4.5 MQTT Binding</a></li>
  </ul>
  <li><a href="05-index-encoding.html#sec:encoding">5 Message Encoding</a></li>
  <ul>
    <li><a href="05-index-encoding.html#sec:parameter-value-encoding">5.1 Parameter and Argument Value Encoding</a></li>
  </ul>
  <li><a href="06-index-e2e-message-exchange.html#sec:e2e-message-exchange">6 End to End Message Exchange</a></li>
  <ul>
    <li><a href="06-index-e2e-message-exchange.html#sec:exchange-of-usp-records-within-an-e2e-session-context">6.1 Exchange of USP Records within an E2E Session Context</a></li>
    <li><a href="06-index-e2e-message-exchange.html#sec:exchange-of-usp-records-without-an-e2e-session-context">6.2 Exchange of USP Records without an E2E Session Context</a></li>
    <li><a href="06-index-e2e-message-exchange.html#sec:validating-the-integrity-of-the-usp-record">6.3 Validating the Integrity of the USP Record</a></li>
    <li><a href="06-index-e2e-message-exchange.html#sec:secure-message-exchange">6.4 Secure Message Exchange</a></li>
  </ul>
  <li><a href="07-index-messages.html#sec:messages">7 Messages</a></li>
  <ul>
    <li><a href="07-index-messages.html#sec:encapsulation-in-a-usp-record">7.1 Encapsulation in a USP Record</a></li>
    <li><a href="07-index-messages.html#sec:requests-responses-and-errors">7.2 Requests, Responses and Errors</a></li>
    <li><a href="07-index-messages.html#sec:message-structure">7.3 Message Structure</a></li>
    <li><a href="07-index-messages.html#sec:creating-updating-and-deleting-objects">7.4 Creating, Updating, and Deleting Objects</a></li>
    <li><a href="07-index-messages.html#sec:reading-an-agents-state-and-capabilities">7.5 Reading an Agent’s State and Capabilities</a></li>
    <li><a href="07-index-messages.html#sec:notifications-and-subscriptions">7.6 Notifications and Subscription Mechanism</a></li>
    <li><a href="07-index-messages.html#sec:defined-operations-mechanism">7.7 Defined Operations Mechanism</a></li>
    <li><a href="07-index-messages.html#sec:error-codes">7.8 Error Codes</a></li>
  </ul>
  <li><a href="08-index-auth.html#sec:auth">8 Authentication and Authorization</a></li>
  <ul>
    <li><a href="08-index-auth.html#sec:authentication-1">8.1 Authentication</a></li>
    <li><a href="08-index-auth.html#sec:role-based-access-control-rbac">8.2 Role Based Access Control (RBAC)</a></li>
    <li><a href="08-index-auth.html#sec:trusted-certificate-authorities">8.3 Trusted Certificate Authorities</a></li>
    <li><a href="08-index-auth.html#sec:trusted-brokers">8.4 Trusted Brokers</a></li>
    <li><a href="08-index-auth.html#sec:self-signed-certificates">8.5 Self-Signed Certificates</a></li>
    <li><a href="08-index-auth.html#sec:agent-authentication">8.6 Agent Authentication</a></li>
    <li><a href="08-index-auth.html#sec:challenge-strings-and-images">8.7 Challenge Strings and Images</a></li>
    <li><a href="08-index-auth.html#sec:analysis-controller-certificates">8.8 Analysis of Controller Certificates</a></li>
    <li><a href="08-index-auth.html#sec:theory-of-operations">8.9 Theory of Operations</a></li>
  </ul>
  <li><a href="09-index-bulk-data-collection.html#sec:bulk-data-collection">Annex A: Bulk Data Collection</a></li>
  <ul>
    <li><a href="09-index-bulk-data-collection.html#sec:introduction-1">A.1 Introduction</a></li>
    <li><a href="09-index-bulk-data-collection.html#sec:http-bulk-data-collection">A.2 HTTP Bulk Data Collection</a></li>
    <li><a href="09-index-bulk-data-collection.html#sec:mqtt-bulk-data-collection">A.3 MQTT Bulk Data Collection</a></li>
    <li><a href="09-index-bulk-data-collection.html#sec:uspeventnotif-bulk-data-collection">A.4 USPEventNotif Bulk Data Collection</a></li>
    <li><a href="09-index-bulk-data-collection.html#sec:using-wildcards-to-reference-object-instances-in-the-report">A.5 Using Wildcards to Reference Object Instances in the Report</a></li>
    <li><a href="09-index-bulk-data-collection.html#sec:using-alternative-names-in-the-report">A.6 Using Alternative Names in the Report</a></li>
    <li><a href="09-index-bulk-data-collection.html#sec:encoding-of-bulk-data">A.7 Encoding of Bulk Data</a></li>
  </ul>
  <li><a href="10-index-software-module-management.html#sec:software-module-management">Appendix I: Software Module Management</a></li>
  <ul>
    <li><a href="10-index-software-module-management.html#sec:lifecycle-management">I.1 Lifecycle Management</a></li>
    <li><a href="10-index-software-module-management.html#sec:software-modules">I.2 Software Modules</a></li>
    <li><a href="10-index-software-module-management.html#sec:execution-environment-concepts">I.3 Execution Environment Concepts</a></li>
    <li><a href="10-index-software-module-management.html#sec:fault-model">I.4 Fault Model</a></li>
  </ul>
  <li><a href="11-index-firmware-management-of-devices-with-usp-agents.html#sec:firmware-management-of-devices-with-usp-agents">Appendix II: Firmware Management of Devices with USP Agents</a></li>
  <ul>
    <li><a href="11-index-firmware-management-of-devices-with-usp-agents.html#sec:getting-the-firmware-image-onto-the-device">II.1 Getting the firmware image onto the device</a></li>
    <li><a href="11-index-firmware-management-of-devices-with-usp-agents.html#sec:using-multiple-firmware-images">II.2 Using multiple firmware images</a></li>
  </ul>
  <li><a href="12-index-device-proxy.html#sec:device-proxy">Appendix III: Device Proxy</a></li>
  <li><a href="13-index-proxying.html#sec:proxying">Appendix IV: Proxying</a></li>
  <ul>
    <li><a href="13-index-proxying.html#sec:proxying-building-block-functions">IV.1 Proxying Building Block Functions</a></li>
    <li><a href="13-index-proxying.html#sec:discovery-proxy">IV.2 Discovery Proxy</a></li>
    <li><a href="13-index-proxying.html#sec:connectivity-proxy">IV.3 Connectivity Proxy</a></li>
    <li><a href="13-index-proxying.html#sec:message-transfer-protocol-mtp-proxy">IV.4 Message Transfer Protocol (MTP) Proxy</a></li>
    <li><a href="13-index-proxying.html#sec:usp-to-non-usp-proxy">IV.5 USP to Non-USP Proxy</a></li>
  </ul>
  <li><a href="14-index-iot-data-model-theory-of-operation.html#sec:iot-data-model-theory-of-operation">Appendix V: IoT Data Model Theory of Operation</a></li>
  <ul>
    <li><a href="14-index-iot-data-model-theory-of-operation.html#sec:introduction-2">V.1 Introduction</a></li>
    <li><a href="14-index-iot-data-model-theory-of-operation.html#sec:iot-data-model-overview">V.2 IoT data model overview</a></li>
    <li><a href="14-index-iot-data-model-theory-of-operation.html#sec:architecture-mappings">V.3 Architecture mappings</a></li>
    <li><a href="14-index-iot-data-model-theory-of-operation.html#sec:iot-data-model-object-details">V.4 IoT data model Object details</a></li>
    <li><a href="14-index-iot-data-model-theory-of-operation.html#sec:examples">V.5 Examples</a></li>
  </ul>
  <li><a href="99-index-footnotes.html#footnotes">Footnotes</a></li>
</ul>
</nav>

    <header id="title-block-header">
      <h1 class="title" id="sec:discovery">3 Discovery and Advertisement<a href="#sec:discovery" class="headerlink" title="Permalink to this header"> <img src="permalink.png" style="width: 0.8em"/></a></h1>
    </header>
    <nav id="_TOC" role="doc-toc">
<ul>
<li><a href="#sec:controller-information">3.1 Controller Information <span><img src="permalink.png" style="width:0.8em" /></span></a></li>
<li><a href="#sec:required-agent-information">3.2 Required Agent Information <span><img src="permalink.png" style="width:0.8em" /></span></a></li>
<li><a href="#sec:using-dhcp">3.3 Use of DHCP for Acquiring Controller Information <span><img src="permalink.png" style="width:0.8em" /></span></a></li>
<li><a href="#sec:using-mdns">3.4 Using mDNS <span><img src="permalink.png" style="width:0.8em" /></span></a></li>
<li><a href="#sec:using-dns">3.5 Using DNS <span><img src="permalink.png" style="width:0.8em" /></span></a></li>
<li><a href="#sec:dns-sd-records">3.6 DNS-SD Records <span><img src="permalink.png" style="width:0.8em" /></span></a></li>
<li><a href="#sec:using-the-sendonboardrequest-operation-and-onboardrequest-notification">3.7 Using the SendOnBoardRequest() operation and OnBoardRequest notification <span><img src="permalink.png" style="width:0.8em" /></span></a></li>
</ul>
    </nav>
<p>Discovery is the process by which USP Endpoints learn the USP properties and MTP connection details of another Endpoint, either for sending USP Messages in the context of an existing relationship (where the Controller’s USP Endpoint Identifier, credentials, and authorized Role are all known to the Agent) or for the establishment of a new relationship.</p>
<p>Advertisement is the process by which USP Endpoints make their presence known (or USP Endpoint presence is made known) to other USP Endpoints.</p>
<h2 id="sec:controller-information">3.1 Controller Information <a href="03-index-discovery.html#sec:controller-information" class="headerlink" title="Permalink to this header"><img src="permalink.png" style="width:0.8em" /></a></h2>
<p>An Agent that has a USP relationship with a Controller needs to know that Controller’s Endpoint Identifier, credentials, and authorized Role.</p>
<p>An Agent that has a USP relationship with a Controller needs to obtain information that allows it to determine at least one MTP, IP address, port, and resource path (if required by the MTP) of the Controller. This may be a URL with all of these components, a FQDN that resolves to provide all of these components via DNS-SD records, or mDNS discovery in the LAN.</p>
<p>Example mechanisms for configuration include but are not limited to:</p>
<ul>
<li>Pre-configured in firmware</li>
<li>Configured by an already-known-and-trusted Controller</li>
<li>Configured through a separate bootstrap mechanism such as a user interface or other management interface.</li>
<li><a href="03-index-discovery.html#sec:using-dhcp" class="heading">DHCP</a>, <a href="03-index-discovery.html#sec:using-dns" class="heading">DNS</a>, or <a href="03-index-discovery.html#sec:using-mdns" class="heading">mDNS</a>.</li>
</ul>
<p><strong><span id="r-dis.0">R-DIS.0 <a href="03-index-discovery.html#r-dis.0" class="headerlink" title="Permalink to this span"><img src="permalink.png" style="width:0.8em" /></a></span></strong> - An Agent that supports USP configuration of Controllers MUST implement the <code>Device.LocalAgent.Controller</code> Object as defined in the Device:2 Data Model <span class="cite" data-citation-ids="TR-181"><a href="01-index-introduction.html#ref-TR-181">[38]</a></span>.</p>
<p>The Agent can be pre-configured with trusted root certificates or trusted certificates to allow authentication of Controllers. Other trust models are also possible, where an Agent without a current Controller association will trust the first discovered Controller, or where the Agent has a UI that allows a User to indicate whether a discovered Controller is authorized to configure that Agent.</p>
<h2 id="sec:required-agent-information">3.2 Required Agent Information <a href="03-index-discovery.html#sec:required-agent-information" class="headerlink" title="Permalink to this header"><img src="permalink.png" style="width:0.8em" /></a></h2>
<p>A Controller that has a relationship with an Agent needs to know the Agent’s Endpoint Identifier, connectivity information for the Agent’s MTP(s), and credentials.</p>
<p>Controllers acquires this information upon initial connection by an Agent, though a LAN based Controller may acquire an Agent’s MTP information through mDNS Discovery. It is each Controller’s responsibility to maintain a record of known Agents.</p>
<h2 id="sec:using-dhcp">3.3 Use of DHCP for Acquiring Controller Information <a href="03-index-discovery.html#sec:using-dhcp" class="headerlink" title="Permalink to this header"><img src="permalink.png" style="width:0.8em" /></a></h2>
<p>DHCP can be employed as a method for Agents to discover Controllers. The DHCPv4 Vendor-Identifying Vendor-Specific Information Option <span class="cite" data-citation-ids="RFC3925"><a href="01-index-introduction.html#ref-RFC3925">[13]</a></span> (option code 125) and DHCPv6 Vendor-specific Information Option <span class="cite" data-citation-ids="RFC3315"><a href="01-index-introduction.html#ref-RFC3315">[12]</a></span> (option code 17) can be used to provide information to Agents about a single Controller. The options that may be returned by DNS are shown below. Description of these options can be found in the Device:2 Data Model <span class="cite" data-citation-ids="TR-181"><a href="01-index-introduction.html#ref-TR-181">[38]</a></span>.</p>
<p><strong><span id="r-dis.1">R-DIS.1 <a href="03-index-discovery.html#r-dis.1" class="headerlink" title="Permalink to this span"><img src="permalink.png" style="width:0.8em" /></a></span></strong> - If an Agent is configured to request Controller DHCP information, the Agent MUST include in its DHCPv4 requests a DHCPv4 V-I Vendor Class Option (option 124) and in its DHCPv6 requests a DHCPv6 Vendor Class (option 16). This option MUST include the Broadband Forum Enterprise Number (<code>3561</code> decimal, <code>0x0DE9</code> hex) as an enterprise-number, and the string “<code>usp</code>” (all lower case) in a vendor-class-data instance associated with this enterprise-number.</p>
<p><strong><span id="r-dis.1a">R-DIS.1a <a href="03-index-discovery.html#r-dis.1a" class="headerlink" title="Permalink to this span"><img src="permalink.png" style="width:0.8em" /></a></span></strong> - The Agent MUST decode all received options as strings (provisioning code, wait interval, and interval multiplier are not decoded as numeric fields).</p>
<p><strong><span id="r-dis.1b">R-DIS.1b <a href="03-index-discovery.html#r-dis.1b" class="headerlink" title="Permalink to this span"><img src="permalink.png" style="width:0.8em" /></a></span></strong> - The Agent MUST interpret a received URL or FQDN of the Controller as either an absolute URL or FQDN.</p>
<p><strong><span id="r-dis.1c">R-DIS.1c <a href="03-index-discovery.html#r-dis.1c" class="headerlink" title="Permalink to this span"><img src="permalink.png" style="width:0.8em" /></a></span></strong> - If the Agent receives an encapsulated option value that is null terminated, the Agent MUST accept the value provided, and MUST NOT interpret the null character as part of the value.</p>
<p>The Role to associate with a DHCP-discovered Controller is programmatically determined (see <a href="08-index-auth.html#sec:auth" class="heading">Authentication and Authorization</a>).</p>
<p><em>Note: Requirement R-DIS.2 was removed in USP 1.2.</em></p>
<p>See <a href="03-index-discovery.html#sec:using-dns" class="heading">Using DNS</a> for requirements on resolving URLs and FQDNs provided by DHCP.</p>
<p>ISPs are advised to limit the use of DHCP for configuration of a Controller to situations in which the security of the link between the DHCP server and the Agent can be assured by the service provider. Since DHCP does not itself incorporate a security mechanism, it is a good idea to use pre-configured certificates or other means of establishing trust between the Agent and a Controller discovered by DHCP.</p>
<h3 id="sec:dhcp-options-for-controller-discovery">3.3.1 DHCP Options for Controller Discovery <a href="03-index-discovery.html#sec:dhcp-options-for-controller-discovery" class="headerlink" title="Permalink to this header"><img src="permalink.png" style="width:0.8em" /></a></h3>
<table>
<colgroup>
<col style="width: 26%" />
<col style="width: 26%" />
<col style="width: 28%" />
<col style="width: 21%" />
</colgroup>
<thead>
<tr class="header header">
<th style="text-align: right;">Encapsulated Option</th>
<th style="text-align: center;">DHCPv4 Option 125</th>
<th style="text-align: center;">DHCPv6 Option 17</th>
<th style="text-align: left;">Parameter in the Device:2 Data Model <span class="cite" data-citation-ids="TR-181"><a href="01-index-introduction.html#ref-TR-181">[38]</a></span></th>
</tr>
</thead>
<tbody>
<tr class="odd odd">
<td style="text-align: right;">URL or FQDN of the Controller</td>
<td style="text-align: center;"><code>25</code></td>
<td style="text-align: center;"><code>25</code></td>
<td style="text-align: left;"><code>Dependent on MTP</code></td>
</tr>
<tr class="even even">
<td style="text-align: right;">Provisioning code</td>
<td style="text-align: center;"><code>26</code></td>
<td style="text-align: center;"><code>26</code></td>
<td style="text-align: left;"><code>Device.LocalAgent.Controller.{i}.ProvisioningCode</code></td>
</tr>
<tr class="odd odd">
<td style="text-align: right;">USP retry minimum wait interval</td>
<td style="text-align: center;"><code>27</code></td>
<td style="text-align: center;"><code>27</code></td>
<td style="text-align: left;"><code>Device.LocalAgent.Controller.{i}.USPNotifRetryMinimumWaitInterval</code></td>
</tr>
<tr class="even even">
<td style="text-align: right;">USP retry interval multiplier</td>
<td style="text-align: center;"><code>28</code></td>
<td style="text-align: center;"><code>28</code></td>
<td style="text-align: left;"><code>Device.LocalAgent.Controller.{i}.USPNotifRetryIntervalMultiplier</code></td>
</tr>
<tr class="odd odd">
<td style="text-align: right;">Endpoint ID of the Controller</td>
<td style="text-align: center;"><code>29</code></td>
<td style="text-align: center;"><code>29</code></td>
<td style="text-align: left;"><code>Device.LocalAgent.Controller.{i}.EndpointID</code></td>
</tr>
</tbody>
</table>
<h2 id="sec:using-mdns">3.4 Using mDNS <a href="03-index-discovery.html#sec:using-mdns" class="headerlink" title="Permalink to this header"><img src="permalink.png" style="width:0.8em" /></a></h2>
<p><strong><span id="r-dis.3">R-DIS.3 <a href="03-index-discovery.html#r-dis.3" class="headerlink" title="Permalink to this span"><img src="permalink.png" style="width:0.8em" /></a></span></strong> - If mDNS discovery is supported by a USP Endpoint, the USP Endpoint MUST implement mDNS client and server functionality as defined in RFC 6762 <span class="cite" data-citation-ids="RFC6762"><a href="01-index-introduction.html#ref-RFC6762">[24]</a></span>.</p>
<p><strong><span id="r-dis.4">R-DIS.4 <a href="03-index-discovery.html#r-dis.4" class="headerlink" title="Permalink to this span"><img src="permalink.png" style="width:0.8em" /></a></span></strong> - If mDNS advertisement for a MTP is enabled on an Endpoint, the Endpoint MUST listen for messages using that MTP from other Endpoints requesting establishment of USP communication over that MTP.</p>
<p><strong><span id="r-dis.5">R-DIS.5 <a href="03-index-discovery.html#r-dis.5" class="headerlink" title="Permalink to this span"><img src="permalink.png" style="width:0.8em" /></a></span></strong> - If mDNS is enabled, a USP Endpoint MUST use mDNS to resolve a FQDN with domain “<code>.local.</code>”.</p>
<p>In general, the expectation is that Agents will advertise themselves so they will be discoverable by Controllers. Controllers are not expected to advertise themselves, but are expected to discover Agents and respond to applicable mDNS requests from Agents. Agents will use mDNS to resolve a Controller “<code>.local.</code>” FQDN (and get DNS-SD records) when the Agent needs to send a Notification to that Controller.</p>
<h2 id="sec:using-dns">3.5 Using DNS <a href="03-index-discovery.html#sec:using-dns" class="headerlink" title="Permalink to this header"><img src="permalink.png" style="width:0.8em" /></a></h2>
<p>Requirements for implementation of a DNS client and configuration of the DNS client with DNS server address(es) (through static configuration, DHCPv4, DHCPv6, or Router Solicitation) are not provided. These are sufficiently well-known that they were not considered necessary for this specification. If the Agent knows of no DNS Server, it cannot do DNS resolution.</p>
<p><strong><span id="r-dis.6">R-DIS.6 <a href="03-index-discovery.html#r-dis.6" class="headerlink" title="Permalink to this span"><img src="permalink.png" style="width:0.8em" /></a></span></strong> - If DNS is enabled, an Endpoint MUST use DNS to request IP address(es) (A and/or AAAA records, depending on confiured IP stacks) for a FQDN with domain other than ones used for mDNS (<a href="03-index-discovery.html#r-dis.5" class="requirement">R-DIS.5</a>).</p>
<p>If the Endpoint is programmatically set to request other resource records, it will request those, too.</p>
<p><strong><span id="r-dis.7">R-DIS.7 <a href="03-index-discovery.html#r-dis.7" class="headerlink" title="Permalink to this span"><img src="permalink.png" style="width:0.8em" /></a></span></strong> - If the Agent is resolving an FQDN for a Controller, and the MTP or resource path are unknown, the Agent MUST request DNS-SD information (PTR, SRV and TXT resource records) in addition to A, AAAA or other resource records it is programmatically set to request.</p>
<h2 id="sec:dns-sd-records">3.6 DNS-SD Records <a href="03-index-discovery.html#sec:dns-sd-records" class="headerlink" title="Permalink to this header"><img src="permalink.png" style="width:0.8em" /></a></h2>
<p>DNS Service Discovery (DNS-SD) RFC 6763 <span class="cite" data-citation-ids="RFC6763"><a href="01-index-introduction.html#ref-RFC6763">[25]</a></span> is a mechanism for naming and structuring of DNS resource records to facilitate service discovery. It can be used to create DNS records for USP Endpoints, so they can be discoverable via DNS PTR queries RFC 1035 <span class="cite" data-citation-ids="RFC1035"><a href="01-index-introduction.html#ref-RFC1035">[7]</a></span> or Multicast DNS (mDNS) RFC 6762 <span class="cite" data-citation-ids="RFC6762"><a href="01-index-introduction.html#ref-RFC6762">[24]</a></span>. DNS-SD uses DNS SRV and TXT records to express information about “services”, and DNS PTR records to help locate the SRV and TXT records. To discover these DNS records, DNS or mDNS queries can be used. RFC 6762 <span class="cite" data-citation-ids="RFC6762"><a href="01-index-introduction.html#ref-RFC6762">[24]</a></span> recommends using the query type PTR to get both the SRV and TXT records. A and AAAA records will also be returned, for address resolution.</p>
<p>The format of a DNS-SD Service Instance Name (which is the resource record (RR) Name of the DNS SRV and TXT records) is “<code>&lt;Instance&gt;.&lt;Service&gt;.&lt;Domain&gt;</code>”. <code>&lt;Instance&gt;</code> will be the USP Endpoint Identifier of the USP Endpoint.</p>
<p><strong><span id="r-dis.8">R-DIS.8 <a href="03-index-discovery.html#r-dis.8" class="headerlink" title="Permalink to this span"><img src="permalink.png" style="width:0.8em" /></a></span></strong> - USP Endpoint DNS-SD records MUST include the USP Endpoint Identifier of the USP Endpoint as the DNS-SD Service Instance Name.</p>
<p>Service Name values <a href="http://www.broadband-forum.org/assignments">registered by BBF with IANA</a> used by USP are shown below. As described in RFC 6763 <span class="cite" data-citation-ids="RFC6763"><a href="01-index-introduction.html#ref-RFC6763">[25]</a></span>, the <code>&lt;Service&gt;</code> part of a Service Instance Name is constructed from these values as “<code>_&lt;Service Name&gt;._&lt;Transport Protocol&gt;</code>” (e.g., “<code>_usp-agt-ws._tcp</code>”).</p>
<h3 id="sec:iana-registered-usp-service-names">3.6.1 IANA-Registered USP Service Names <a href="03-index-discovery.html#sec:iana-registered-usp-service-names" class="headerlink" title="Permalink to this header"><img src="permalink.png" style="width:0.8em" /></a></h3>
<table>
<thead>
<tr class="header header">
<th style="text-align: right;">Service Name</th>
<th style="text-align: center;">Transport Protocol</th>
<th style="text-align: center;">MTP</th>
<th style="text-align: left;">Type of USP Endpoint</th>
</tr>
</thead>
<tbody>
<tr class="odd odd">
<td style="text-align: right;"><code>usp-agt-coap</code></td>
<td style="text-align: center;">udp</td>
<td style="text-align: center;">CoAP</td>
<td style="text-align: left;">Agent</td>
</tr>
<tr class="even even">
<td style="text-align: right;"><code>usp-agt-mqtt</code></td>
<td style="text-align: center;">tcp</td>
<td style="text-align: center;">MQTT</td>
<td style="text-align: left;">Agent</td>
</tr>
<tr class="odd odd">
<td style="text-align: right;"><code>usp-agt-stomp</code></td>
<td style="text-align: center;">tcp</td>
<td style="text-align: center;">STOMP</td>
<td style="text-align: left;">Agent</td>
</tr>
<tr class="even even">
<td style="text-align: right;"><code>usp-agt-ws</code></td>
<td style="text-align: center;">tcp</td>
<td style="text-align: center;">WebSocket</td>
<td style="text-align: left;">Agent</td>
</tr>
<tr class="odd odd">
<td style="text-align: right;"><code>usp-ctr-coap</code></td>
<td style="text-align: center;">udp</td>
<td style="text-align: center;">CoAP</td>
<td style="text-align: left;">Controller</td>
</tr>
<tr class="even even">
<td style="text-align: right;"><code>usp-ctr-mqtt</code></td>
<td style="text-align: center;">tcp</td>
<td style="text-align: center;">MQTT</td>
<td style="text-align: left;">Controller</td>
</tr>
<tr class="odd odd">
<td style="text-align: right;"><code>usp-ctr-stomp</code></td>
<td style="text-align: center;">tcp</td>
<td style="text-align: center;">STOMP</td>
<td style="text-align: left;">Controller</td>
</tr>
<tr class="even even">
<td style="text-align: right;"><code>usp-ctr-ws</code></td>
<td style="text-align: center;">tcp</td>
<td style="text-align: center;">WebSocket</td>
<td style="text-align: left;">Controller</td>
</tr>
</tbody>
</table>
<p>DNS PTR records with a service subtype identifier (e.g., <code>._&lt;subtype&gt;._usp-agt-ws._tcp.&lt;Domain&gt;</code>) in the RR can be used to provide searchable simple (single layer) functional groupings of USP Agents. The registry of subtypes for Service Names registered by BBF is listed at <a href="http://www.broadband-forum.org/assignments">www.broadband-forum.org/assignments</a>. DNS SRV and TXT records can be pointed to by multiple PTR records, which allow a USP Endpoint to potentially be discoverable as belonging to various functional groupings.</p>
<p>DNS TXT records allow for a small set of additional information to be included in the reply sent to the querier. This information cannot be used as search criteria. The registry of TXT record attributes for BBF Service Names are listed at <a href="http://www.broadband-forum.org/assignments">www.broadband-forum.org/assignments</a>.</p>
<p><strong><span id="r-dis.9">R-DIS.9 <a href="03-index-discovery.html#r-dis.9" class="headerlink" title="Permalink to this span"><img src="permalink.png" style="width:0.8em" /></a></span></strong> - Agent DNS-SD records MUST include a TXT record with the “path” and “name” attributes.</p>
<p><strong><span id="r-dis.10">R-DIS.10 <a href="03-index-discovery.html#r-dis.10" class="headerlink" title="Permalink to this span"><img src="permalink.png" style="width:0.8em" /></a></span></strong> - The “name” attribute included in the Agent DNS-SD records MUST be identical to the <code>FriendlyName</code> Parameter defined in the Device:2 Data Model <span class="cite" data-citation-ids="TR-181"><a href="01-index-introduction.html#ref-TR-181">[38]</a></span>, if the <code>FriendlyName</code> Parameter is implemented.</p>
<p><strong><span id="r-dis.11">R-DIS.11 <a href="03-index-discovery.html#r-dis.11" class="headerlink" title="Permalink to this span"><img src="permalink.png" style="width:0.8em" /></a></span></strong> - Controller DNS-SD records MUST include a TXT record with the “path” attribute.</p>
<p>The “path” attribute is dependent on each <a href="04-index-mtp.html#sec:mtp" class="heading">MTP</a>.</p>
<p><strong><span id="r-dis.11a">R-DIS.11a <a href="03-index-discovery.html#r-dis.11a" class="headerlink" title="Permalink to this span"><img src="permalink.png" style="width:0.8em" /></a></span></strong> - If a USP Endpoint requires MTP encryption to be used when connecting to its advertised service, it MUST include the “encrypt” parameter in the TXT record.</p>
<p>The “encrypt” parameter is Boolean and does not require a value to be specified. Its presence means MTP encryption is required when connecting to the advertised service. Its absence means MTP encryption is not required when connecting to the advertised service.</p>
<p>The TXT record can include other attributes defined in the TXT record attribute registry, as well.</p>
<p>Whether a particular USP Endpoint responds to DNS or mDNS queries or populates (through configuration or mDNS advertisement) their information in a local DNS-SD server can be a configured option that can be enabled/disabled, depending on the intended deployment usage scenario.</p>
<h3 id="sec:example-controller-unicast-dns-sd-resource-records">3.6.2 Example Controller Unicast DNS-SD Resource Records <a href="03-index-discovery.html#sec:example-controller-unicast-dns-sd-resource-records" class="headerlink" title="Permalink to this header"><img src="permalink.png" style="width:0.8em" /></a></h3>
<pre><code>    ; One PTR record for each supported MTP
    _usp-ctr-ws._tcp.host.example.com      PTR &lt;USP ID&gt;._usp-ctr-ws._tcp.example.com.

    ; One SRV+TXT (DNS-SD Service Instance) record for each supported MTP
    &lt;USP ID&gt;._usp-ctr-ws._tcp.example.com.   SRV 0 1 5684 host.example.com.
    &lt;USP ID&gt;._usp-ctr-ws._tcp.example.com.   TXT &quot;&lt;length byte&gt;path=&lt;pathname&gt;&lt;length byte&gt;encrypt&quot;

    ; Controller A and AAAA records
    host.example.com.  A      192.0.2.200
    host.example.com.  AAAA   2001:db8::200</code></pre>
<h3 id="sec:example-agent-multicast-dns-sd-resource-records">3.6.3 Example Agent Multicast DNS-SD Resource Records <a href="03-index-discovery.html#sec:example-agent-multicast-dns-sd-resource-records" class="headerlink" title="Permalink to this header"><img src="permalink.png" style="width:0.8em" /></a></h3>
<pre><code>    ; One PTR record (DNS-SD Service) for each supported MTP
    _usp-agt-ws._tcp                 PTR &lt;USP ID&gt;._usp-agt-ws._tcp.local.

    ; One PTR record (DNS-SD Service Subtype) for each supported MTP per device type
    _iot-device._sub._usp-agt-ws._tcp    PTR &lt;USP ID&gt;._usp-agt-ws._tcp.local.
    _gateway._sub._usp-agt-ws._tcp       PTR &lt;USP ID&gt;._usp-agt-ws._tcp.local.

    ; One SRV+TXT record (DNS-SD Service Instance) for each supported MTP
    &lt;USP ID&gt;._usp-agt-ws._tcp.local.    SRV 0 1 5684 &lt;USP ID&gt;.local.
    &lt;USP ID&gt;._usp-agt-ws._tcp.local.    TXT &quot;&lt;length byte&gt;path=&lt;pathname&gt;&lt;length byte&gt;name=kitchen light&lt;length byte&gt;encrypt&quot;

    ; Agent A and AAAA records
    &lt;USP ID&gt;.local.  A      192.0.2.100
    &lt;USP ID&gt;.local.  AAAA   2001:db8::100</code></pre>
<h3 id="sec:example-controller-multicast-dns-sd-resource-records">3.6.4 Example Controller Multicast DNS-SD Resource Records <a href="03-index-discovery.html#sec:example-controller-multicast-dns-sd-resource-records" class="headerlink" title="Permalink to this header"><img src="permalink.png" style="width:0.8em" /></a></h3>
<p>LAN Controllers do not need to have PTR records, as they will only be queried using the DNS-SD instance identifier of the Controller.</p>
<pre><code>    ; One SRV+TXT record (DNS-SD Service Instance) for each supported MTP
    &lt;USP ID&gt;._usp-ctr-ws._tcp.local.    SRV 0 1 5683 &lt;USP ID&gt;.local.
    &lt;USP ID&gt;._usp-ctr-ws._tcp.local.    TXT &quot;&lt;length byte&gt;path=&lt;pathname&gt;&quot;

    ; Controller A and AAAA records
    &lt;USP ID&gt;.local.  A      192.0.2.200
    &lt;USP ID&gt;.local.  AAAA   2001:db8::200</code></pre>
<h2 id="sec:using-the-sendonboardrequest-operation-and-onboardrequest-notification">3.7 Using the SendOnBoardRequest() operation and OnBoardRequest notification <a href="03-index-discovery.html#sec:using-the-sendonboardrequest-operation-and-onboardrequest-notification" class="headerlink" title="Permalink to this header"><img src="permalink.png" style="width:0.8em" /></a></h2>
<p>An “OnBoardRequest” notification can be sent by an Agent to a Controller to begin an on-boarding process (for example, when the Agent first comes online and discovers a Controller using DHCP). Its use is largely driven by policy, but there is a mechanism other Controllers can use to ask an Agent to send “OnBoardRequest” to another Controller: the SendOnBoardRequest() command is defined in the Device:2 Data Model <span class="cite" data-citation-ids="TR-181"><a href="01-index-introduction.html#ref-TR-181">[38]</a></span>. See <a href="07-index-messages.html#sec:notification-types" class="heading">Notification Types</a> for additional information about the OnBoardRequest notification.</p>
    <div style="clear: both;"/>
    <footer class="site-footer">
<nav>
<p>
   <a href="00-index-contents.html#contents">Cover Page</a>
 | <a href="01-index-introduction.html#sec:introduction">1 Introduction</a>
 | <a href="02-index-architecture.html#sec:architecture">2 Architecture</a>
 | <a href="03-index-discovery.html#sec:discovery">3 Discovery and Advertisement</a>
 | <a href="04-index-mtp.html#sec:mtp">4 Message Transfer Protocols</a>
 | <a href="05-index-encoding.html#sec:encoding">5 Message Encoding</a>
 | <a href="06-index-e2e-message-exchange.html#sec:e2e-message-exchange">6 End to End Message Exchange</a>
 | <a href="07-index-messages.html#sec:messages">7 Messages</a>
 | <a href="08-index-auth.html#sec:auth">8 Authentication and Authorization</a>
 | <a href="09-index-bulk-data-collection.html#sec:bulk-data-collection">Annex A: Bulk Data Collection</a>
 | <a href="10-index-software-module-management.html#sec:software-module-management">Appendix I: Software Module Management</a>
 | <a href="11-index-firmware-management-of-devices-with-usp-agents.html#sec:firmware-management-of-devices-with-usp-agents">Appendix II: Firmware Management of Devices with USP Agents</a>
 | <a href="12-index-device-proxy.html#sec:device-proxy">Appendix III: Device Proxy</a>
 | <a href="13-index-proxying.html#sec:proxying">Appendix IV: Proxying</a>
 | <a href="14-index-iot-data-model-theory-of-operation.html#sec:iot-data-model-theory-of-operation">Appendix V: IoT Data Model Theory of Operation</a>
 | <a href="99-index-footnotes.html#footnotes">Footnotes</a>
</p>
</nav>

      <span class="site-footer-owner">
        USP is developed and maintained
        by <a href="https://www.broadband-forum.org">The Broadband Forum</a>.
        &copy; The Broadband Forum 2022</a>. All Rights Reserved.
      </span>
      <span class="site-footer-credits">
        This page was generated by <a href="https://pandoc.org">pandoc</a>
        and <a href="https://pages.github.com">GitHub Pages</a>.
        View the <a href="https://github.com/BroadbandForum/usp">specification source on GitHub</a>.
        <span class="release"/>
      </span>
    </footer>
  </section>
</body>
</html>
